<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SellInSeconds - Product Uploader</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
    input, textarea, button {
      width: 100%; padding: 10px; margin-top: 10px;
      font-size: 16px; border: 1px solid #ccc; border-radius: 5px;
    }
    button { background-color: #28a745; color: white; font-weight: bold; }
    .success { color: green; font-weight: bold; margin-top: 10px; }
    .error { color: red; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>üì§ Add Product to SellInSeconds</h2>
  <form id="productForm">
    <label>Product ID</label>
    <input type="number" id="id" required />

    <label>Model Name</label>
    <input type="text" id="model" required />

    <label>Price (‚Çπ...)</label>
    <input type="text" id="price" required />

    <label>Description</label>
    <textarea id="description" rows="4" required></textarea>

    <button type="submit">Upload Product</button>
    <div id="status"></div>
  </form>

  <script>
  function base64EncodeUnicode(str) {
  return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,
    function(match, p1) {
      return String.fromCharCode('0x' + p1);
    }
  ));
}
    const token = "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"; // Embedded token (safe for public repo use)
    const repo = "pathanthanveerahmed/sellinseconds";
    const path = "dynamic/data.json";
    const branch = "main";

    document.getElementById("productForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const id = parseInt(document.getElementById("id").value.trim());
      const model = document.getElementById("model").value.trim().replace(/Ô£ø/g, "");
      let price = document.getElementById("price").value.trim();
      const description = document.getElementById("description").value.trim().replace(/Ô£ø/g, "");

      if (!price.startsWith("‚Çπ")) price = "‚Çπ" + price;

      const statusEl = document.getElementById("status");
      statusEl.textContent = "‚è≥ Updating GitHub...";

      const api = "https://api.github.com/repos/" + repo + "/contents/" + path;

      try {
        const res = await fetch(api, {
          headers: { Authorization: "token " + token }
        });

        const json = await res.json();
        const sha = json.sha;
        const content = atob(json.content);

        let data = JSON.parse(content);
        const newEntry = {
          id,
          name: model + " ‚Äì " + price,
          description
        };

        const index = data.images.findIndex(p => p.id === id);
        if (index >= 0) {
          data.images[index] = newEntry;
        } else {
          data.images.push(newEntry);
        }

        const updated = {
          message: `Auto-add ID ${id} ‚Äì ${model}`,
          content: base64EncodeUnicode(JSON.stringify(data, null, 2)),
          sha,
          branch
        };

        const uploadRes = await fetch(api, {
          method: "PUT",
          headers: {
            Authorization: "token " + token,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(updated)
        });

        if (uploadRes.ok) {
          statusEl.textContent = "‚úÖ Product updated successfully!";
          document.getElementById("productForm").reset();
        } else {
          statusEl.textContent = "‚ùå Upload failed. Check token or repo path.";
        }
      } catch (err) {
        statusEl.textContent = "‚ùå Error: " + err.message;
      }
    });
  </script>
</body>
</html>
