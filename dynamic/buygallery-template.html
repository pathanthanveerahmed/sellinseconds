<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... (head content remains unchanged) ... -->
</head>

<body>
  <!-- ... (body content remains unchanged) ... -->

  <script>
    const gallery = document.getElementById("gallery");

    async function loadGallery() {
      const res = await fetch("https://www.sellinseconds.in/dynamic/data.json?v=" + Date.now());
      const data = await res.json();
      const active = Number(String(data.active).trim());
      
      // Find the correct sequence - the one that ends with the active card
      let sequence = [];
      for (let i = 0; i < data.sequences.length; i++) {
        const seq = data.sequences[i];
        if (seq.length > 0 && seq[seq.length - 1] === active) {
          sequence = seq;
          break;
        }
      }
      
      // Fallback if no matching sequence found
      if (sequence.length === 0) {
        const sequenceIndex = active > data.sequences.length ? 0 : active - 1;
        sequence = Array.isArray(data.sequences?.[sequenceIndex]) 
          ? data.sequences[sequenceIndex] 
          : [];
      }

      const validCards = data.images.filter(x => x.name && x.description && x.filename);
      const cardMap = Object.fromEntries(validCards.map(x => [Number(String(x.id).trim()), x]));

      // Create cards in reverse order to put latest at top
      const cards = [];
      for (let i = sequence.length - 1; i >= 0; i--) {
        const id = sequence[i];
        const item = cardMap[Number(String(id).trim())];
        if (!item) continue;

        cards.push(`
          <div class="card" data-id="${item.id}">
            <div class="img-wrapper">
              ${Number(String(item.id).trim()) === active ? `<span class="badge">Newly Added</span>` : ``}
              <img src="/dynamic/images/${item.filename}" alt="Buy ${item.name} on SellInSeconds" loading="lazy" />
            </div>
            <h3>${item.name}</h3>
            <p>${item.description}</p>
            <div class="whatsapp-buttons-row">
              <a href="https://wa.me/?text=https://www.sellinseconds.in/dynamic/wacust/${item.id}.html" target="_blank">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" /> Interested?
              </a>
              <span class="arrow-text">⬇️ More ⬆️</span>
              <a href="https://wa.me/?text=https://www.sellinseconds.in/dynamic/wacust/${item.id}.html" target="_blank">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" /> Edit & Share
              </a>
            </div>
          </div>`);
      }

      gallery.innerHTML = cards.join("");
      setupScrollHighlight(active);
    }

    function setupScrollHighlight(activeId) {
      const loadingEl = document.getElementById("loading");
      const targetEl = document.querySelector(`[data-id="${activeId}"]`);
      if (!targetEl) {
        loadingEl.style.display = "none";
        return;
      }

      const imgs = document.querySelectorAll("img");
      let loaded = 0, done = false;

      const finish = () => {
        if (done) return;
        done = true;
        loadingEl.style.display = "none";
        targetEl.scrollIntoView({ behavior: "auto", block: "start" });
        setTimeout(() => {
          window.scrollBy(0, -60);
          setTimeout(() => window.scrollBy(0, 60), 300);
        }, 200);
        targetEl.classList.add("highlight");
      };

      imgs.forEach(img => {
        if (img.complete) loaded++;
        else img.addEventListener("load", () => {
          loaded++;
          if (loaded === imgs.length) finish();
        });
      });

      setTimeout(finish, 1200);
    }

    window.addEventListener("load", loadGallery);
  </script>
</body>
</html>