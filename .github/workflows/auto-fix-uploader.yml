name: 🔁 Auto Fix Uploader & OG HTMLs

on:
  push:
    paths:
      - 'dynamic/data.json'
      - 'dynamic/images/**'
      - 'dynamic/generate-html-with-versioned-images.js'
      - 'dynamic/generate-wacust.js'
      - 'dynamic/buygallery-template.html'
      - 'dynamic/1to30-template.html'

jobs:
  regenerate:
    runs-on: ubuntu-latest

    steps:
      - name: ⬇️ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 🟢 Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: 🕐 Wait for WebP to sync
        run: sleep 5

      - name: ⚙️ Generate buygallery.html
        run: node dynamic/generate-html-with-versioned-images.js

      - name: ⚙️ Generate wacust/1–30.html
        run: node dynamic/generate-wacust.js

      - name: ✅ Commit and Push HTML files
        run: |
          git config user.name "Uploader Bot"
          git config user.email "bot@sellinseconds.in"

          git add dynamic/buygallery.html dynamic/wacust/*.html
          git diff --cached --quiet && echo "No changes" && exit 0

          git commit -m "🤖 Auto-rebuild after uploader sync"
          git pull origin main --rebase
          git push origin main